# Administration Microsoft 365

## üë• Gestion des utilisateurs

### üîë Types de comptes
- **Microsoft 365 local** : cr√©√© dans le cloud (non li√© √† AD local)
- **Compte synchronis√©** : vient de l‚ÄôAD local (et est transf√©r√© via Azure AD Connect)

### ‚ûï M√©thodes de cr√©ation
- Unitaire (Admin Center) : ``Ajouter un utilisateur`` dans ``Admin center``
- Import CSV : ``Admin center / Autres / Importer plusieurs utilisateurs ``
- PowerShell (`New-MsolUser`)
- Synchronisation AD (Azure AD Connect)
    
### üõ°Ô∏è R√¥les assignables
- Utilisateur simple
- Admin g√©n√©ral / personnalis√© (Admin Exchange, Admin Power BI...)
- D√©l√©gation via **RBAC** (Role Based Access Control)

### üî£ Gestion des utilisateurs en Powershell

<!-- tabs:start -->
##### **Installation et connexion**

##### Installer les modules n√©cessaires

```powershell
Install-Module MSOnline                  
Install-Module ExchangeOnlineManagement
Install-Module MicrosoftTeams
```
##### Connexion aux services cloud Microsoft 365

```powershell
# Azure Active Directory
Connect-MsolService

# Exchange Online
Connect-ExchangeOnline -UserPrincipalName "ton.compte@domaine.onmicrosoft.com" -ShowProgress $true

# SharePoint Online
Connect-SPOService -Url https://votredomaine-admin.sharepoint.com

# Teams
Connect-MicrosoftTeams

# S√©curit√© & conformit√©
Connect-IPPSSession -UserPrincipalName "ton.compte@domaine.onmicrosoft.com"
```
##### V√©rifie les connexions

```powershell 
Get-MsolUser
Get-ExchangeOnlineUser
```
##### **Cr√©ation d'un utilisateur o365**

```powershell
New-MsolUser `
  -UserPrincipalName "jdupont@tondomaine.onmicrosoft.com" ` # Login user
  -DisplayName "Jean Dupont" ` # Nom complet
  -FirstName "Jean" ` # PR√©nom
  -LastName "Dupont" ` # Nom
  -Password "MotDePasseFort123!" ` # Password temporaire
  -ForceChangePassword $true ` # Forcer le changement de password
  -UsageLocation "FR" # Forcer la langue FR
```

##### **Supression / Restauration d'un user o365**


```powershell
# Supprimer un user -> Gard√© dans la corbeille Azure AD 30 jours 
Remove-MsolUser -UserPrincipalName "jdupont@tondomaine.onmicrosoft.com"

# Restaurer un user dans la corbeille
Restore-MsolUser -UserPrincipalName "jdupont@tondomaine.onmicrosoft.com"

# Voir les users supprim√©s 
Get-MsolUser -ReturnDeletedUsers

# Supprimer D√©finitivement un compte (hard delete)
Remove-MsolUser -UserPrincipalName "jdupont@tondomaine.onmicrosoft.com" -RemoveFromRecycleBin -Force

```

<!-- tabs:end -->
## üí≥ Gestion des licences

### üß∞ Outils possibles

|M√©thode|Avantages|
|---|---|
|**Portail Microsoft 365 Admin**|Interface graphique, simple √† utiliser|
|**PowerShell (MSOnline / AzureAD)**|Rapide, automatisable, indispensable en entreprise|

### üì¶ Plans Exchange Online

| Plan                  | Bo√Æte mail | Office  | Archivage     | Fonctionnalit√©s            | Cout HT Mensuel |
| --------------------- | ---------- | ------- | ------------- | -------------------------- | --------------- |
| **Business Basic**    | 50 Go      | Web     | 50 Go archive | Mail, Teams, OneDrive      | 5,60 ‚Ç¨          |
| **Business Standard** | 50 Go      | Desktop | 50 Go archive | + Office complet           | 11,70 ‚Ç¨         |
| **Business Premium**  | 50 Go      | Desktop | 50 Go archive | + Intune, Defender         | 20,60 ‚Ç¨         |
| **M365 E3**           | 100 Go     | Desktop | Illimit√©      | Enterprise + s√©curit√©      | 23,50 ‚Ç¨         |
| **M365 E5**           | 100 Go     | Desktop | Illimit√©      | + t√©l√©phonie, audit avanc√© | 39.40 ‚Ç¨         |

### üßæ Gestion des licences 

<!-- tabs:start --> 
#### **Via PowerShell**

```powershell
# Identifier les licences disponibles 
Get-MsolAccountSku

#  Attribuer une licence
Set-MsolUserLicense `
  -UserPrincipalName "jdupont@entreprise.fr" `
  -AddLicenses "TONTENANT:BUSINESS_PREMIUM"

# Retirer une licence
Set-MsolUserLicense `
  -UserPrincipalName "jdupont@entreprise.fr" `
  -RemoveLicenses "TONTENANT:BUSINESS_PREMIUM"

# Attribution en masse par filtre
Get-MsolUser -Department "Comptabilit√©" -UnlicensedUsersOnly | ForEach-Object {
  Set-MsolUserLicense -UserPrincipalName $_.UserPrincipalName -AddLicenses "TONTENANT:BUSINESS_PREMIUM"
}

# V√©rifier les utilisateurs sans licence
Get-MsolUser -All | Where-Object {$_.isLicensed -eq $false}

# Lister les utilisateurs et leur plan actif
Get-MsolUser -All | Select-Object DisplayName, UserPrincipalName, Licenses

```

#### **Via Admin Center**

- Aller dans **Utilisateurs actifs**
- S√©lectionner un utilisateur
- Cliquer sur **Licences et applications**
- Activer ou d√©sactiver les **produits/services inclus**
- Valider
<!-- tabs:end --> 


## üß≠ Destinataires et permissions Exchange Online

- Acc√®s Exchange Control Panel (ou EAC) via :  ``Admin Microsoft 365 > Exchange > Centre d‚Äôadministration Exchange``
- Url directe : https://admin.exchange.microsoft.com/
- Via Powershell

<!-- tabs:start --> 

### **üíªECP / M365 Admin)**


#### üì¶ Quota des bo√Ætes aux lettres
- Acc√®s via : **Centre d‚Äôadministration Exchange (ECP)** > **Destinataires > Bo√Ætes aux lettres**
- S√©lectionner une bo√Æte ‚Üí Modifier ‚Üí onglet **‚ÄúParam√®tres de bo√Æte‚Äù**
- ‚úÖ Modifier :
    - Quota d‚Äôavertissement
    - Quota d‚Äôenvoi
    - Quota d‚Äôenvoi et r√©ception

#### üìÇ Archivage
- ECP ‚Üí Bo√Æte √† modifier ‚Üí **Activer l‚Äôarchivage**
- Cr√©e une **bo√Æte d‚Äôarchive illimit√©e** (extensible par tranches de 100 Go)
- üìå N√©cessite **Exchange Online Plan 2** ou **M365 E3/E5**

#### üßπ R√©tention / Suppression
- ECP ‚Üí **Strat√©gies de r√©tention** ou via **Compliance Center**
- Lien avec la **dur√©e de conservation des √©l√©ments supprim√©s**
- Litige/hold : compliance.microsoft.com > Information Governance

#### üß© Les alias
- Acc√©der √† `https://admin.exchange.microsoft.com/`
- Aller dans **Destinataires > Bo√Ætes aux lettres**
- S√©lectionner l‚Äôutilisateur
- Onglet **Adresse e-mail**
- Cliquer sur **Ajouter une adresse** :
    - Type : **SMTP**
    - Adresse : `alias@entreprise.fr`
- Valider (l‚Äôadresse principale reste en gras)

#### üîÅ Transfert de mail
- Menu **Destinataires > Bo√Ætes aux lettres**
- S√©lectionner l‚Äôutilisateur
- Onglet **Messagerie > Transfert**
- ‚úÖ Activer le transfert
- Saisir l‚Äôadresse cible (interne ou externe)
- Option : **Conserver une copie** dans la bo√Æte d‚Äôorigine
#### üßë‚Äçü§ù‚Äçüßë Gestion des BAL (Salle, √âquipement, Partag√©e)
- Cr√©er depuis ECP :
    - Bo√Ætes partag√©es ‚Üí acc√®s collectif, sans licence si <50 Go
    - Salles / √âquipements ‚Üí pour r√©servation dans les agendas
        
- Permissions via l'onglet **‚ÄúD√©l√©gations‚Äù** :
    - Acc√®s complet (Full Access)
    - Envoyer en tant que (Send As)
    - Envoyer de la part de (Send on behalf)
#### ‚úâÔ∏è Autres types de BAL

- **Contacts de messagerie** : adresse externe, visible dans l‚Äôannuaire
- **Utilisateurs de messagerie** : utilisateurs externes **authentifi√©s**
- **Listes de distribution** : redirige vers plusieurs bo√Ætes
- **Listes dynamiques** : membres calcul√©s via des r√®gles
- **Groupes de s√©curit√© avec extension messagerie** : autorisations + r√©ception mail

### **üî£ Via PowerShell**

#### üì¶ Quota BAL
```powershell
Set-Mailbox -Identity "user@domaine.fr" `
  -IssueWarningQuota 47GB ` # Avertissement
  -ProhibitSendQuota 48GB ` # Blocage Envoi
  -ProhibitSendReceiveQuota 49GB # Blocage total
``` 

#### üìÇ Archivage
```powershell 
Enable-Mailbox -Identity "user@domaine.fr" -Archive

# V√©rification :
Get-Mailbox -Identity "user@domaine.fr" | fl ArchiveStatus
```

#### üßπ R√©tention / Suppression
```powershell
# Dur√©e de r√©tention des √©l√©ments supprim√©s (max 30j par d√©faut)
Set-Mailbox -Identity "user@domaine.fr" -RetainDeletedItemsFor 30
```

#### üß© Les alias

```powershell
# Ajouter un alias 
Set-Mailbox -Identity "prenom.nom@entreprise.fr" -EmailAddresses @{add="alias@entreprise.fr"}

# V√©rifier les alias
Get-Mailbox -Identity "prenom.nom@entreprise.fr" | Select-Object -ExpandProperty EmailAddresses

# Supprimer un alias
Set-Mailbox -Identity "prenom.nom@entreprise.fr" -EmailAddresses @{remove="alias@entreprise.fr"}
```

#### üîÅ Transfert de mail dans Exchange Online
```powershell
Set-Mailbox -Identity "utilisateur@entreprise.fr" `
  -ForwardingSMTPAddress "cible@externe.com" # ForwardingAddress pour de l'interne
  -DeliverToMailboxAndForward $true # garde une copie dans la BAL
  
  # Supprimer un transfert
  Set-Mailbox -Identity "utilisateur@entreprise.fr" `
  -ForwardingSMTPAddress $null `
  -DeliverToMailboxAndForward $false
  
  ```

#### üßë‚Äçü§ù‚Äçüßë BAL Salle / √âquipement / Partag√©e

 **Cr√©ation**
 ```powershell
 # BAL partag√©e
New-Mailbox -Shared -Name "Support" -DisplayName "Support Client" -Alias "support" -PrimarySmtpAddress "support@entreprise.fr"

# Salle
New-Mailbox -Room -Name "Salle R√©union A" -PrimarySmtpAddress "salleA@entreprise.fr"

# √âquipement
New-Mailbox -Equipment -Name "Projecteur" -PrimarySmtpAddress "projecteur@entreprise.fr"

```

**üë• Ajouter des permissions**

```powershell
# Acc√®s complet
Add-MailboxPermission -Identity "support@entreprise.fr" -User "jdupont" -AccessRights FullAccess

# Envoyer en tant que
Add-RecipientPermission -Identity "support@entreprise.fr" -Trustee "jdupont" -AccessRights SendAs

# Envoyer de la part de
Set-Mailbox -Identity "support@entreprise.fr" -GrantSendOnBehalfTo "jdupont"
```

#### ‚úâÔ∏è Autres types de destinataires

üîπ **Contact externe**

`New-MailContact -Name "Partenaire Externe" -ExternalEmailAddress "contact@externe.com"`

üîπ **Utilisateur de messagerie externe (authentifiable)**

`New-MailUser -Name "Prestataire" -ExternalEmailAddress "tech@ssii.com" -UserPrincipalName "tech@entreprise.fr" -Password (ConvertTo-SecureString -String "P@ssw0rd!" -AsPlainText -Force)`

**üîπ Liste de distribution**


`New-DistributionGroup -Name "Equipe RH" -PrimarySmtpAddress "rh@entreprise.fr" -Members user1, user2`

**üîπ Liste dynamique**

`New-DynamicDistributionGroup -Name "Tous les commerciaux" -RecipientFilter {(Department -eq "Commerce")}`

<!-- tabs:end -->


## üë• Groupes dans Microsoft 365 / Exchange Online

### üß©**Les types de groupes**

|**Type de groupe**|üìß Re√ßoit des mails|ü§ù Collaboration (Teams, SharePoint...)|üîê Gestion des droits (acc√®s fichiers)|‚öôÔ∏è Cr√©ation via|
|---|---|---|---|---|
|**Groupe Microsoft 365**|‚úÖ Oui|‚úÖ Oui|‚ùå Non _(pas pour les permissions ACL)_|Portail M365|
|**Groupe de distribution**|‚úÖ Oui|‚ùå Non|‚ùå Non|ECP / PowerShell|
|**Groupe de s√©curit√© (classique)**|‚ùå Non (ou ‚úÖ si mail-enabled)|‚ùå Non|‚úÖ Oui|Azure AD / M365|

### üë• Cr√©er un groupe
<!-- tabs:start -->
#### **Graphiquement**
##### üñ±Ô∏è Depuis le centre d‚Äôadministration Exchange (ECP)
- **Liste de distribution**
- **Groupe de s√©curit√© avec extension de messagerie**
- **Groupe dynamique**

##### üñ±Ô∏è Depuis le portail M365 
- **Groupes Microsoft 365**
- **Groupe de s√©curit√© sans mail**
#### **Via Powershell**

```powershell
# Liste de diffusion 
New-DistributionGroup -Name "Support IT" -PrimarySmtpAddress "support@entreprise.fr"

# Groupe de s√©curit√© mail-enabled
New-DistributionGroup -Name "Acc√®s Projets" -PrimarySmtpAddress "projets@entreprise.fr" -Type Security

# Groupe de distribution dynamique 
New-DynamicDistributionGroup -Name "Tous les RH" -RecipientFilter {(Department -eq "Ressources Humaines")}

# Lister les groupes 
Get-DistributionGroup
```

```powershell
# Ajouter des membres 
Add-DistributionGroupMember -Identity "Support IT" -Member "jdupont@entreprise.fr"

# Retirer des membres 
Remove-DistributionGroupMember -Identity "Support IT" -Member "jdupont@entreprise.fr"

# Voir les membres 
Get-DistributionGroupMember -Identity "Support IT"
```
<!-- tabs:end -->


## üì¨ Administration Exchange Online 

### üåê **Les domaines accept√©s**

- Un **domaine** est l‚Äô√©quivalent DNS de ton organisation (ex : `entreprise.fr`)
- Types :
    - **Faisant autorit√©** : tous les mails entrants pour ce domaine sont **g√©r√©s par Microsoft 365**
    - **Relais interne** : Microsoft 365 **relaye le message** vers un autre serveur (n√©cessite connecteurs)

### üì© **Suivi des messages**

Utilis√© par les admins pour :
- Retrouver la **trace d‚Äôun message** (envoy√©, re√ßu, bloqu√©, filtr√©‚Ä¶)
- Diagnostiquer les probl√®mes de flux
- Acc√®s via **ECP > Suivi des messages**

### üìú **R√®gles de transport (mail flow rules)**

Permettent d‚Äôimposer des **politiques de messagerie** :

|Exemple d‚Äôusage|Explication|
|---|---|
|Bloquer les `.exe`|Emp√™cher la r√©ception de certaines pi√®ces jointes|
|Ajouter une signature|Modifier les en-t√™tes ou contenu du message|
|Rediriger vers un responsable|Examiner les mails sensibles avant livraison|
|Journaliser les √©changes avec un client|Archive automatique pour conformit√©|

üõ†Ô∏è Compos√©es de :
- **Conditions** (ex : si pi√®ce jointe `.exe`)
- **Actions** (ex : bloquer ou rediriger)
- **Exceptions** (ex : pas pour le DG)
üí° Priorit√© = ordre de traitement (0 = plus prioritaire)


### üîó **Connecteurs Exchange**

Utilis√©s pour :
- üîÅ Faire le lien avec un **serveur Exchange local**
- üì† Permettre aux **copieurs, applis, imprimantes** d‚Äôenvoyer des mails
- üì© Accepter les mails d‚Äôun **partenaire externe**
- üîê Appliquer un **chiffrement sp√©cial** selon domaine cible
üß† Par d√©faut ‚Üí **aucun connecteur requis**, mais **n√©cessaire d√®s qu‚Äôon sort de l‚Äôusage standard**


### üì§ **Relais SMTP (cas d‚Äôusage courant)**

Exemple : tu veux qu‚Äôun **copieur multifonction** envoie des scans par mail.

‚Üí Cr√©er un **connecteur sortant** :
- Sans authentification si usage interne
- Limite le nombre de machines qui peuvent envoyer du SMTP
- √âvite de surcharger les entr√©es DNS (SPF)

### üì∂ **Protocoles & ports support√©s**

|Protocole|Port s√©curis√©|Usage|
|---|---|---|
|HTTP / HTTPS|443|Webmail / Autodiscover|
|POP3|995|Clients mail classiques (peu recommand√©)|
|IMAP4|993|Thunderbird / Linux|
|MAPI / HTTPS|443|Outlook|
|ActiveSync|443|T√©l√©phones mobiles|
|SMTP (sortant)|587 / 465|Envoi de mail|

‚ùó **Le port 25 est souvent bloqu√©** chez les FAI ‚Üí pr√©f√©rer 587 ou relais interne

### üß† Autodiscover (d√©couverte automatique)

- Permet √† Outlook de **configurer automatiquement le profil**
- Repose sur un enregistrement **CNAME** dans le DNS :
```shell
Alias : autodiscover
Cible : autodiscover.outlook.com
```
### üìÅ Types de fichiers Outlook

| Extension     | Description                                      |
| ------------- | ------------------------------------------------ |
| `.pst`        | Donn√©es locales (POP3)                           |
| `.ost`        | Fichier de cache Mode hors ligne (Exchange/IMAP) |
| `.nst`        | Conversations de groupes Outlook                 |
| `spscoll.dat` | Suggestions de mails dans le champ ‚Äú√Ä‚Äù           |

## üì± Gestion des appareils mobiles

### üß© Concepts cl√©s

|Terme|Signification|Exemple concret|
|---|---|---|
|**MDM**|Mobile Device Management|Appliquer des strat√©gies sur un mobile (chiffrement, mot de passe, effacement √† distance)|
|**MAM**|Mobile Application Management|Contr√¥ler uniquement **les applications pro** (Outlook, OneDrive‚Ä¶) sans g√©rer l‚Äôappareil|
|**BYOD**|Bring Your Own Device|L‚Äôutilisateur utilise son smartphone perso|
|**COPE**|Corporate Owned, Personally Enabled|Appareil fourni par l‚Äôentreprise, usage mixte|
|**CYOD**|Choose Your Own Device|L‚Äôutilisateur choisit un appareil dans une liste valid√©e|
### üîê Que peut-on imposer avec MDM / Intune ?

|Fonction|Exemple|
|---|---|
|üîí Mot de passe complexe|Code PIN requis pour acc√©der aux apps pro|
|üîê Chiffrement du t√©l√©phone|Interdiction d‚Äôacc√©der aux donn√©es si l‚Äôappareil n‚Äôest pas chiffr√©|
|üßº Effacement √† distance|Wipe total (MDM) ou **selective wipe** (MAM)|
|üìµ Blocage du copier/coller|Emp√™che de copier des infos de Outlook vers WhatsApp|
|üìß Restriction des apps mail|Autoriser uniquement Outlook pour les mails pro|
|üìç G√©orestriction / conformit√©|Refus d'acc√®s si appareil root√© / jailbreak√©|

### ‚òÅÔ∏è Microsoft Intune

- Plateforme **MDM/MAM Cloud** int√©gr√©e √† Microsoft 365
- Permet une **gestion centralis√©e** des appareils
- Accessible via :  
    [https://endpoint.microsoft.com](https://endpoint.microsoft.com)
    üíº Inclus dans certaines licences

### üìã Enregistrement DNS pour l‚Äôenr√¥lement

Pour permettre l‚Äôenregistrement automatique des appareils dans l‚Äôorganisation 

|Enregistrement DNS|Cible|
|---|---|
|`EnterpriseEnrollment`|`EnterpriseEnrollment.manage.microsoft.com`|
|`EnterpriseRegistration`|`EnterpriseRegistration.windows.net`|

### üß≠ Comment √ßa se passe pour un utilisateur ?

1. üì≤ Il t√©l√©charge **Portail d‚Äôentreprise Intune**
2. üîê Se connecte avec ses **identifiants M365**
3. üîß L‚Äôapp configure l‚Äôappareil selon les **r√®gles MDM**
4. ‚úÖ Il peut acc√©der √† Outlook, OneDrive, Teams‚Ä¶
5. üîí Si l‚Äôappareil est non conforme ‚Üí **bloqu√© automatiquement**

## üîó Azure AD

C'est un service **cloud** de gestion des identit√©s et des annuaires.
Il permet : 
- Gestion des utilisateurs
- Gestion des appareils
- Se connecter √† un AD local

### ‚öôÔ∏è Fonctionnement

| √âl√©ment                            | R√¥le                                                                 |
| ---------------------------------- | -------------------------------------------------------------------- |
| **Active Directory local (AD DS)** | Source des comptes utilisateurs (on-prem)                            |
| **Azure AD**                       | Annuaire cloud utilis√© par Microsoft 365 (ind√©pendant de l'AD Local) |
| **Azure AD Connect**               | L‚Äôagent interm√©diaire qui synchronise les deux environnements        |
| Microsoft 365                      | S'appui sur Azure AD pour valider les acc√®s aux services M365        |

üß† Azure AD Connect peut synchroniser :
- Les **utilisateurs**
- Les **groupes**
- Les **attributs** (mail, phone, etc.)
- Les **mots de passe** (optionnel)

### üîÅ Types de synchronisation

| Mode de synchro                       | Description                                                          |
| ------------------------------------- | -------------------------------------------------------------------- |
| **Uni-directionnelle** (standard)     | AD local ‚Üí Azure AD                                                  |
| **Avec Writeback**                    | Azure AD peut √©crire **vers l‚ÄôAD local** (n√©cessite licence premium) |
| **Password Hash Sync**                | Les mots de passe sont hach√©s puis synchronis√©s vers Azure AD        |
| **Pass-through Authentication (PTA)** | Authentification directe via un agent, le mot de passe reste local   |
### üîß Installation de Azure AD Connect

- L‚Äôoutil est install√© sur **un serveur Windows membre du domaine**
- Le compte AD utilis√© doit avoir **des droits d‚Äôadministration**
- Le domaine doit √™tre **v√©rifi√© dans Azure AD** (via Microsoft 365 admin)

#### 1Ô∏è‚É£ Cr√©er un suffixe UPN compatible

- Aller dans **Domaines et approbations Active Directory**
- Clic droit / Propri√©t√© / Ajouter un suffix DNS 
    üëâ Exemple : `entreprise.local` ‚ùå ‚Üí ajouter `entreprise.fr` ‚úÖ

#### 2Ô∏è‚É£ Modifier le suffixe UPN des utilisateurs

- Pour chaque utilisateur AD, remplace le suffixe `@domaine.local` par `@domaine.fr`
- Cette √©tape est cruciale pour que la **synchronisation fonctionne** correctement avec Azure AD

Script de modification en masse : 
```powershell
# Import du module Active Directory
Import-Module ActiveDirectory

# Modifier tous les utilisateurs dont le UPN se termine par @domaine.local
Get-ADUser -Filter * -SearchBase "OU=Utilisateurs,DC=entreprise,DC=local" -Properties UserPrincipalName, mail | ForEach-Object {
    $upn = $_.UserPrincipalName
    if ($upn -like "*@domaine.local") {
        $newUPN = $upn -replace "@domaine.local", "@domaine.fr"
        $newMail = $newUPN

        Write-Host "Mise √† jour : $upn ‚Üí $newUPN et $($_.mail) ‚Üí $newMail"

        Set-ADUser $_ `
            -UserPrincipalName $newUPN `
            -EmailAddress $newMail `
            -Replace @{mail = $newMail}
    }
}
```

Ou Selectionner tous les ``users / Clic droit / propri√©t√© /  Compte / Suffixe UPN``
Compl√©ter les adresse email de chaque user
#### 3Ô∏è‚É£ Cr√©er un **compte de service d√©di√©** √† la synchronisation

- Ce compte **AD** doit :
    - √ätre d√©di√© **exclusivement √† Azure AD Connect**
    - Avoir les **droits requis** pour lire/√©crire dans l‚ÄôAD local
    - √ätre **prot√©g√©** (pas utilis√© pour d‚Äôautres t√¢ches)
- √âviter d‚Äôutiliser un **compte admin standard** ‚Üí ‚ùå **mauvaise pratique**
- En pratique, on fait une **copie du compte admin** que l'on renommera **SRV-ADCONNECT** avec un **password qui n'expire jamais** pour √©viter les soucis lors du renouvellement de mot de passe 

- **Refaire la m√™me manipulation sur M365 Admin Center** - **SRV-AZUREAD**
	- Ajouter ce nouvel user aux admins dans : r√¥le / Administrateur g√©n√©ral / Ajouter
#### 4Ô∏è‚É£ V√©rifier que ton domaine est **v√©rifi√© dans Microsoft 365**

üëâ Connecte-toi √† [https://admin.microsoft.com](https://admin.microsoft.com)
> **Centre d‚Äôadministration Microsoft 365 > Param√®tres > Domaines**
- Assure-toi que le domaine `entreprise.fr` est bien **ajout√© et valid√©**
- Cela garantit que les **UPN synchronis√©s** seront reconnus comme valides

#### 5Ô∏è‚É£ T√©l√©charger et lancer l‚Äôinstalleur Azure AD Connect

üîó T√©l√©chargement officiel :  
[https://www.microsoft.com/en-us/download/details.aspx?id=47594](https://www.microsoft.com/en-us/download/details.aspx?id=47594)

- Ex√©cute le fichier `AzureADConnect.msi` sur le serveur d√©di√©
- Lance l‚Äôassistant d‚Äôinstallation

#### 6Ô∏è‚É£ Choisir le type d‚Äôinstallation

 ‚û§ **Installation Express** (recommand√©e pour les tests)
- Tout est configur√© automatiquement
- Synchro de **tous les utilisateurs + tous les attributs**
    
‚û§ **Installation Personnalis√©e** ‚úÖ **(recommand√©e en entreprise)**
- Rentrer le Compte de domaine MONDOMAINE\SRV-ADCONNECT
- Connexion √† azure AD : Utiliser le compte SRV-AZUREAD
- Ajouter un annuaire : Creer un compte AD : MONDOMAINE\SRV-ADCONNECT
- Ajouter la foret du domaine 
- Nom d'utilisateur principal : UPN
- ‚úÖ Continuer sans faire correspondre tous les suffixes UPN
- Laisser le reste par defaut

Si les utilisateurs n'ont pas de licences, ``les selectionner / ... / G√©rer les licences de produits / remplacer / Cocher la licence et enregistrer 
#### 7Ô∏è‚É£ Authentification et connexion``

L‚Äôassistant va te demander :
- üîê Un compte **Azure AD / Microsoft 365** ‚Üí doit √™tre **Global Administrator**
- üë§ Un compte **AD local** ‚Üí doit avoir **droits en lecture sur les objets utilisateurs**

> üí° Tu peux cr√©er un compte sp√©cifique pour chaque r√¥le, avec d√©l√©gation fine

#### 8Ô∏è‚É£ Choisir la m√©thode d‚Äôauthentification

|Option|Description|Remarques|
|---|---|---|
|**Password Hash Synchronization** ‚úÖ|Les mots de passe hach√©s sont synchronis√©s|Le plus simple √† maintenir|
|**Pass-Through Authentication (PTA)**|Auth locale via agent|N√©cessite agent toujours en ligne|
|**Federation avec AD FS**|Authentification via AD FS local|Complexe, rarement utilis√© aujourd‚Äôhui|

üëâ Pour TSSR et PME, **Password Hash Sync** est g√©n√©ralement **la meilleure option**

#### 9Ô∏è‚É£ S√©lection des OU √† synchroniser

- Tu peux **exclure certaines OU** (ex : comptes de test, comptes machine‚Ä¶)
- Cela **r√©duit la charge** et √©vite de synchroniser des comptes inutiles

#### üîü Finaliser la configuration

- V√©rifie le r√©sum√©
- Laisse coch√©e l‚Äôoption **‚ÄúLancer la synchronisation initiale‚Äù**
- Clique sur **Installer**

#### ‚úÖ √âtapes post-installation

- Lancer manuellement une synchro si besoin : `Start-ADSyncSyncCycle -PolicyType Initial`
- Ouvrir l‚Äôoutil graphique : `Synchronization Service Manager`

## üõ°Ô∏è RBAC ‚Äì Role-Based Access Control

Donner aux utilisateurs (ou admins) **les droits dont ils ont besoin**, ni plus, ni moins.
üîê Tu ne donnes **pas des droits directs** (comme sur un fichier), mais tu **assignes un r√¥le √† un utilisateur ou groupe**.

### üß© Structure de RBAC dans Exchange Online

|√âl√©ment|R√¥le|
|---|---|
|**R√¥le (Role)**|D√©crit un ensemble d‚Äô**actions autoris√©es**|
|**Groupe de r√¥les (Role Group)**|Contient un ou plusieurs r√¥les|
|**Membre du groupe**|Un **utilisateur ou groupe** qui h√©rite des r√¥les|

### üóÇÔ∏è Exemples de r√¥les

| R√¥le                                | Ce qu‚Äôil permet de faire                         |
| ----------------------------------- | ------------------------------------------------ |
| `Mail Recipients`                   | G√©rer les bo√Ætes aux lettres                     |
| `Transport Rules`                   | G√©rer les r√®gles de flux (mail flow)             |
| `View-Only Organization Management` | Voir la configuration Exchange                   |
| `Mailbox Search`                    | Effectuer des recherches eDiscovery              |
| `Compliance Management`             | G√©rer l‚Äôaudit, les strat√©gies de r√©tention, DLP‚Ä¶ |
### üìÅ Exemples de groupes de r√¥les

| Groupe de r√¥les           | Utilisateurs typiques                               |
| ------------------------- | --------------------------------------------------- |
| `Organization Management` | Admin global Exchange                               |
| `Recipient Management`    | Admin RH ou helpdesk (gestion utilisateurs)         |
| `Compliance Management`   | DSI, RSSI (strat√©gies, audits, DLP)                 |
| `Records Management`      | Archivage, √©tiquettes                               |
| `Help Desk`               | Support de niveau 1 (r√©initialisation mot de passe) |
### Quelques commandes PowerShell

```powershell
Get-MsolRole # Liste des r√¥les
Get-MsolUserRole # Voir les r√¥les des users
Add-MsolROleMembrer # Ajouter des membres √† un role
```