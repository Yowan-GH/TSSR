# Supervision distribuÃ©e avec Centreon

## ğŸ—ï¸ Architecture distribuÃ©e

| Composant            | RÃ´le principal                                                                                 |
| -------------------- | ---------------------------------------------------------------------------------------------- |
| **Centreon Central** | Serveur principal (interface Web, base de donnÃ©es, moteur central (Engine), Broker principalâ€¦) |
| **Centreon Pollers** | Serveur distant avec moteur de supervision (Engine) + Broker (module uniquement)               |

### ğŸ” Fonctionnement gÃ©nÃ©ral

- Le serveur **Central** est responsable :
    - de l'interface Web
    - de la base de donnÃ©es
    - de la centralisation des rÃ©sultats
        
- Chaque **poller** est indÃ©pendant : 
    - Il exÃ©cute des **checks** localement via `centreon-engine`
    - Il transmet les rÃ©sultats via `centreon-broker` (module) vers le Central
    - Si la connexion avec le Central est perdue, les rÃ©sultats sont stockÃ©s temporairement

### ğŸ” Communication Central â†” Poller

- Les fichiers de configuration sont gÃ©nÃ©rÃ©s sur le Central, puis envoyÃ©s vers chaque poller.
- Lâ€™agent **Gorgone** du Central pousse ces fichiers via :
    - **SSH** (avec Ã©change de clÃ©s RSA)
    - ou **ZMQ** (ZeroMQ)

## âš™ï¸ Ã‰lÃ©ments logiciels impliquÃ©s

|Ã‰lÃ©ment|Sur Central ?|Sur Poller ?|RÃ´le|
|---|---|---|---|
|`centreon-engine`|âœ…|âœ…|ExÃ©cution des commandes de supervision|
|`centreon-broker-module`|âœ…|âœ…|Collecte des rÃ©sultats|
|`centreon-broker-database`|âœ…|âŒ|Insertion en base de donnÃ©es|
|Base de donnÃ©es (MariaDB, etc.)|âœ…|âŒ|Stockage centralisÃ©|
|Interface Web Centreon|âœ…|âŒ|Interface utilisateur|
|Agent Gorgone|âœ…|âŒ|Distribution des fichiers vers les pollers|

## ğŸ› ï¸ Configuration dâ€™un poller dans Centreon
#### 1. **DÃ©ploiement du poller**
Sur le **serveur poller** :
- Installer **Centreon-Engine**
- Installer **Centreon-Broker**
- Installer **Gorgone** (agent de communication avec le Central)
- Assurer la connectivitÃ© SSH (ou ZMQ) avec le Central

#### 2. **Ajout du poller dans le Central**
Depuis lâ€™interface Web Centreon :
- Aller dans `Configuration â†’ Pollers`
- CrÃ©er un nouveau poller avec :
    - Nom
    - Adresse IP
    - MÃ©thode de communication (SSH ou ZMQ)
    - Chemin dâ€™accÃ¨s Ã  la configuration
    - Type de transfert : `SSH`, `gorgone`, ou `scp`
#### 3. **Assignation des hÃ´tes au poller**
Toujours depuis Centreon Web 
- Lors de la crÃ©ation ou modification dâ€™un hÃ´te :
    - Associer ce dernier au **poller souhaitÃ©** dans le champ â€œMonitoring Engineâ€

> ğŸ’¡ Cela permet de rÃ©partir les hÃ´tes/services entre plusieurs pollers.

#### 4. **Exportation de la configuration**
- Aller dans `Configuration â†’ Pollers â†’ Export Configuration`
- SÃ©lectionner le poller â†’ cliquer sur :
    - `Generate Configuration Files`
    - `Export`
    - `Reload`

âœ… Les fichiers sont alors transfÃ©rÃ©s automatiquement vers le poller, qui recharge sa configuration via Gorgone.

## ğŸ” RÃ©silience & indÃ©pendance des pollers

### ğŸ” Fonctionnement en autonomie

|Fonction|DÃ©tail|
|---|---|
|**IndÃ©pendance locale**|Chaque poller a son propre `centreon-engine` et exÃ©cute ses checks seul|
|**Cache temporaire**|Si le Central est indisponible, le poller **stocke localement** les rÃ©sultats|
|**Reprise automatique**|DÃ¨s que la connexion est rÃ©tablie, les rÃ©sultats sont **envoyÃ©s en diffÃ©rÃ©** au Central|
|**Pas dâ€™interface Web**|Un poller **nâ€™affiche rien** : il nâ€™a ni interface Web ni base de donnÃ©es|

### ğŸ’¡ Avantages
- Permet la supervision de sites **distants ou isolÃ©s**
- Pas de perte de donnÃ©es en cas de coupure rÃ©seau temporaire
- RÃ©partition de charge optimisÃ©e sur des environnements Ã  grande Ã©chelle
## ğŸ“¦ Historique technique

- Avant : supervision distribuÃ©e basÃ©e sur **Nagios + NDOUtils**
- Aujourdâ€™hui : remplacement par **Centreon-Engine + Centreon-Broker**

> ğŸ”„ `NDOMOD` devient `centreon-broker-module`  
> ğŸ—ƒï¸ `NDO2DB` devient `centreon-broker-database`



## ğŸ’¡ Cas dâ€™usage

- **Charge Ã©levÃ©e** : des centaines ou milliers dâ€™hÃ´tes/services â†’ on rÃ©partit sur plusieurs moteurs
- **Sites distants** : supervision impossible en direct (VPN, bande passante limitÃ©eâ€¦) â†’ un poller est placÃ© localement