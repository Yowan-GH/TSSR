# Supervision distribuée avec Centreon

## 🏗️ Architecture distribuée

| Composant            | Rôle principal                                                                                 |
| -------------------- | ---------------------------------------------------------------------------------------------- |
| **Centreon Central** | Serveur principal (interface Web, base de données, moteur central (Engine), Broker principal…) |
| **Centreon Pollers** | Serveur distant avec moteur de supervision (Engine) + Broker (module uniquement)               |

### 🔁 Fonctionnement général

- Le serveur **Central** est responsable :
    - de l'interface Web
    - de la base de données
    - de la centralisation des résultats
        
- Chaque **poller** est indépendant : 
    - Il exécute des **checks** localement via `centreon-engine`
    - Il transmet les résultats via `centreon-broker` (module) vers le Central
    - Si la connexion avec le Central est perdue, les résultats sont stockés temporairement

### 🔐 Communication Central ↔ Poller

- Les fichiers de configuration sont générés sur le Central, puis envoyés vers chaque poller.
- L’agent **Gorgone** du Central pousse ces fichiers via :
    - **SSH** (avec échange de clés RSA)
    - ou **ZMQ** (ZeroMQ)

## ⚙️ Éléments logiciels impliqués

|Élément|Sur Central ?|Sur Poller ?|Rôle|
|---|---|---|---|
|`centreon-engine`|✅|✅|Exécution des commandes de supervision|
|`centreon-broker-module`|✅|✅|Collecte des résultats|
|`centreon-broker-database`|✅|❌|Insertion en base de données|
|Base de données (MariaDB, etc.)|✅|❌|Stockage centralisé|
|Interface Web Centreon|✅|❌|Interface utilisateur|
|Agent Gorgone|✅|❌|Distribution des fichiers vers les pollers|

## 🛠️ Configuration d’un poller dans Centreon
#### 1. **Déploiement du poller**
Sur le **serveur poller** :
- Installer **Centreon-Engine**
- Installer **Centreon-Broker**
- Installer **Gorgone** (agent de communication avec le Central)
- Assurer la connectivité SSH (ou ZMQ) avec le Central

#### 2. **Ajout du poller dans le Central**
Depuis l’interface Web Centreon :
- Aller dans `Configuration → Pollers`
- Créer un nouveau poller avec :
    - Nom
    - Adresse IP
    - Méthode de communication (SSH ou ZMQ)
    - Chemin d’accès à la configuration
    - Type de transfert : `SSH`, `gorgone`, ou `scp`
#### 3. **Assignation des hôtes au poller**
Toujours depuis Centreon Web 
- Lors de la création ou modification d’un hôte :
    - Associer ce dernier au **poller souhaité** dans le champ “Monitoring Engine”

> 💡 Cela permet de répartir les hôtes/services entre plusieurs pollers.

#### 4. **Exportation de la configuration**
- Aller dans `Configuration → Pollers → Export Configuration`
- Sélectionner le poller → cliquer sur :
    - `Generate Configuration Files`
    - `Export`
    - `Reload`

✅ Les fichiers sont alors transférés automatiquement vers le poller, qui recharge sa configuration via Gorgone.

## 🔁 Résilience & indépendance des pollers

### 🔐 Fonctionnement en autonomie

|Fonction|Détail|
|---|---|
|**Indépendance locale**|Chaque poller a son propre `centreon-engine` et exécute ses checks seul|
|**Cache temporaire**|Si le Central est indisponible, le poller **stocke localement** les résultats|
|**Reprise automatique**|Dès que la connexion est rétablie, les résultats sont **envoyés en différé** au Central|
|**Pas d’interface Web**|Un poller **n’affiche rien** : il n’a ni interface Web ni base de données|

### 💡 Avantages
- Permet la supervision de sites **distants ou isolés**
- Pas de perte de données en cas de coupure réseau temporaire
- Répartition de charge optimisée sur des environnements à grande échelle
## 📦 Historique technique

- Avant : supervision distribuée basée sur **Nagios + NDOUtils**
- Aujourd’hui : remplacement par **Centreon-Engine + Centreon-Broker**

> 🔄 `NDOMOD` devient `centreon-broker-module`  
> 🗃️ `NDO2DB` devient `centreon-broker-database`



## 💡 Cas d’usage

- **Charge élevée** : des centaines ou milliers d’hôtes/services → on répartit sur plusieurs moteurs
- **Sites distants** : supervision impossible en direct (VPN, bande passante limitée…) → un poller est placé localement